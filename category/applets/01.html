<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>小程序开发知识总结 | grantguo 撸小灶</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="images/smile.ico">
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?xxxxxxxxxxxxxxxx"; 
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();</script>
    <script language="javascript" type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">
    <script src="/blog/js/snow.js"></script>
    <meta name="description" content="open a small stove">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="grantguo,博客,grant,yongsheng">
    
    <link rel="preload" href="/blog/assets/css/0.styles.9b71e8e9.css" as="style"><link rel="preload" href="/blog/assets/js/app.e39775f7.js" as="script"><link rel="preload" href="/blog/assets/js/4.fb892f91.js" as="script"><link rel="preload" href="/blog/assets/js/1.43efb79e.js" as="script"><link rel="preload" href="/blog/assets/js/14.9bc216f3.js" as="script"><link rel="preload" href="/blog/assets/js/13.b05cf968.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.86661fab.js"><link rel="prefetch" href="/blog/assets/js/11.9284f3fb.js"><link rel="prefetch" href="/blog/assets/js/12.15007db8.js"><link rel="prefetch" href="/blog/assets/js/15.43b71447.js"><link rel="prefetch" href="/blog/assets/js/16.a5b3aaf8.js"><link rel="prefetch" href="/blog/assets/js/17.f0632293.js"><link rel="prefetch" href="/blog/assets/js/18.cf30dd93.js"><link rel="prefetch" href="/blog/assets/js/19.962611ba.js"><link rel="prefetch" href="/blog/assets/js/2.ab78cd66.js"><link rel="prefetch" href="/blog/assets/js/20.5fd90141.js"><link rel="prefetch" href="/blog/assets/js/21.0ccf5833.js"><link rel="prefetch" href="/blog/assets/js/22.86e5998e.js"><link rel="prefetch" href="/blog/assets/js/23.72dd629e.js"><link rel="prefetch" href="/blog/assets/js/24.c2bd8914.js"><link rel="prefetch" href="/blog/assets/js/25.48c71f35.js"><link rel="prefetch" href="/blog/assets/js/26.02ca05d2.js"><link rel="prefetch" href="/blog/assets/js/27.68a19490.js"><link rel="prefetch" href="/blog/assets/js/28.bf4ac0ff.js"><link rel="prefetch" href="/blog/assets/js/29.dd0e2efe.js"><link rel="prefetch" href="/blog/assets/js/30.8ae24bc0.js"><link rel="prefetch" href="/blog/assets/js/31.5c9fbc44.js"><link rel="prefetch" href="/blog/assets/js/32.d1f16935.js"><link rel="prefetch" href="/blog/assets/js/33.c837d2a3.js"><link rel="prefetch" href="/blog/assets/js/34.271bc466.js"><link rel="prefetch" href="/blog/assets/js/35.29bee1ed.js"><link rel="prefetch" href="/blog/assets/js/36.2304bdf1.js"><link rel="prefetch" href="/blog/assets/js/37.e93cac58.js"><link rel="prefetch" href="/blog/assets/js/38.816db319.js"><link rel="prefetch" href="/blog/assets/js/39.0d4bb9cf.js"><link rel="prefetch" href="/blog/assets/js/40.6fb75ff2.js"><link rel="prefetch" href="/blog/assets/js/41.b40b5d94.js"><link rel="prefetch" href="/blog/assets/js/42.dd9d45f0.js"><link rel="prefetch" href="/blog/assets/js/43.70cbd464.js"><link rel="prefetch" href="/blog/assets/js/44.0e4683f4.js"><link rel="prefetch" href="/blog/assets/js/45.a9de11f2.js"><link rel="prefetch" href="/blog/assets/js/46.ed3dab7d.js"><link rel="prefetch" href="/blog/assets/js/47.7ecc3081.js"><link rel="prefetch" href="/blog/assets/js/5.b66c608a.js"><link rel="prefetch" href="/blog/assets/js/6.e0d88385.js"><link rel="prefetch" href="/blog/assets/js/7.28e67498.js"><link rel="prefetch" href="/blog/assets/js/8.e5291ea1.js"><link rel="prefetch" href="/blog/assets/js/9.f3623830.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.9b71e8e9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-0f44a727><div data-v-0f44a727><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-0f44a727 data-v-0f44a727><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-355e03f9 data-v-0f44a727 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>grantguo 撸小灶</h3> <p class="description" data-v-355e03f9 data-v-355e03f9>open a small stove</p> <label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" value="" data-v-355e03f9> <span data-v-355e03f9>Konck! Knock!</span> <button data-v-355e03f9>OK</button></label> <div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span> <span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i> <a data-v-355e03f9><span data-v-355e03f9>grantguo</span>
            
          <span data-v-355e03f9>2021 - </span>
          2023
        </a></span></div></div> <div class="hide" data-v-0f44a727><header class="navbar" data-v-0f44a727><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/images/avatar.jpeg" alt="grantguo 撸小灶" class="logo"> <span class="site-name">grantguo 撸小灶</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/小程序/" class="nav-link"><i class="undefined"></i>
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/浏览器/" class="nav-link"><i class="undefined"></i>
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/http/" class="nav-link"><i class="undefined"></i>
  http
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/https/" class="nav-link"><i class="undefined"></i>
  https
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Javascript/" class="nav-link"><i class="undefined"></i>
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/管理工作坊/" class="nav-link"><i class="undefined"></i>
  管理工作坊
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/issue/" class="nav-link"><i class="undefined"></i>
  issue
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="https://github.com/ForeverGuo/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-0f44a727></div> <aside class="sidebar" data-v-0f44a727><div class="personal-info-wrapper" data-v-5aaeb100 data-v-0f44a727><img src="/blog/images/avatar.jpeg" alt="author-avatar" class="personal-img" data-v-5aaeb100> <h3 class="name" data-v-5aaeb100>
    grantguo
  </h3> <div class="num" data-v-5aaeb100><div data-v-5aaeb100><h3 data-v-5aaeb100>34</h3> <h6 data-v-5aaeb100>Articles</h6></div> <div data-v-5aaeb100><h3 data-v-5aaeb100>34</h3> <h6 data-v-5aaeb100>Tags</h6></div></div> <ul class="social-links" data-v-5aaeb100><li class="social-item" data-v-5aaeb100><i class="iconfont reco-wechat" style="color:#f8b26a;" data-v-5aaeb100></i></li><li class="social-item" data-v-5aaeb100><i class="iconfont reco-npm" style="color:#3498db;" data-v-5aaeb100></i></li></ul> <hr data-v-5aaeb100></div> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/categories/小程序/" class="nav-link"><i class="undefined"></i>
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/浏览器/" class="nav-link"><i class="undefined"></i>
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/http/" class="nav-link"><i class="undefined"></i>
  http
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/https/" class="nav-link"><i class="undefined"></i>
  https
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/Javascript/" class="nav-link"><i class="undefined"></i>
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/管理工作坊/" class="nav-link"><i class="undefined"></i>
  管理工作坊
</a></li><li class="dropdown-item"><!----> <a href="/blog/categories/issue/" class="nav-link"><i class="undefined"></i>
  issue
</a></li></ul></div></div><div class="nav-item"><a href="/blog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="https://github.com/ForeverGuo/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-355e03f9 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>小程序开发知识总结</h3> <!----> <label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" value="" data-v-355e03f9> <span data-v-355e03f9>Konck! Knock!</span> <button data-v-355e03f9>OK</button></label> <div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span> <span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i> <a data-v-355e03f9><span data-v-355e03f9>grantguo</span>
            
          <span data-v-355e03f9>2021 - </span>
          2023
        </a></span></div></div> <div data-v-0f44a727><main class="page"><section><div class="page-title"><h1 class="title">小程序开发知识总结</h1> <div data-v-40f7a244><i class="iconfont reco-account" data-v-40f7a244><span data-v-40f7a244>grantguo</span></i> <i class="iconfont reco-date" data-v-40f7a244><span data-v-40f7a244>2022-05-14</span></i> <!----> <i class="tags iconfont reco-tag" data-v-40f7a244><span class="tag-item" data-v-40f7a244>小程序</span><span class="tag-item" data-v-40f7a244>uniapp</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="概览"><a href="#概览" class="header-anchor">#</a> 概览</h2> <p><img src="/blog/assets/img/UniApp.ed04f1e8.svg" alt=""></p> <h2 id="登录"><a href="#登录" class="header-anchor">#</a> 登录</h2> <h3 id="微信"><a href="#微信" class="header-anchor">#</a> 微信</h3> <p><img src="/blog/assets/img/wx_login.2fcc9f35.jpg" alt=""></p> <ul><li><p>调用wx.login() 获取 临时登录凭证code，并传回开发者服务器</p></li> <li><p>调用auth.code2Session 接口，换取 用户唯一标识 OpenId，用户在微信开放平台账户下的唯一标识UnionID（若当前小程序已绑定到微信开放平台账户） 和 会话密钥 session_key</p></li> <li><p>之后开发者服务器可以根据用户标识来生成自定义登录态，用于后续业务逻辑中前后端交互时识别用户身份</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">&quot;getPhoneNumber&quot;</span> @getphonenumber<span class="token operator">=</span><span class="token string">&quot;getPhoneNumber&quot;</span>
			<span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;wx_login&quot;</span><span class="token operator">&gt;</span>微信用户一键登录<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token comment">// 获取微信code</span>
<span class="token function">getWxCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    uni<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      provider<span class="token operator">:</span> <span class="token string">'weixin'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">loginRes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>loginRes<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 获取微信 用户信息 静默获取</span>
<span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取用户信息</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    uni<span class="token punctuation">.</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      provider<span class="token operator">:</span> <span class="token string">'weixin'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">infoRes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>infoRes<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fail</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>fail<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token keyword">async</span> <span class="token function">getPhoneNumber</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>errMsg<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> encryptedData<span class="token punctuation">,</span> iv  <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">;</span>
    <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
      encryptedData<span class="token punctuation">,</span>
      iv<span class="token punctuation">,</span>
      token<span class="token punctuation">,</span>  <span class="token comment">// 通过 wx_code 用户信息 兑换</span>
      session_key <span class="token comment">// 会话密钥 通过 wx_code 用户信息 获取 </span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> common<span class="token punctuation">.</span><span class="token function">wxGoGetPhoneNumber</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token comment">/*
    * user_key 登录态标识
    * user_id 用户登录态 id
    * person_token 根据用户信息 code 生成的
    * open_id 用户唯一标识
    */</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> user_key<span class="token punctuation">,</span> user_id<span class="token punctuation">,</span> person_tokne<span class="token punctuation">,</span> open_id <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div></li></ul> <h3 id="支付宝"><a href="#支付宝" class="header-anchor">#</a> 支付宝</h3> <ul><li><p>获取 auth_user code</p></li> <li><p>通过 code 向开发服务端获取 token</p></li> <li><p>根据 token ，手机号授权后获取 encryptedData 加密串</p></li> <li><p>开发服务端结合签名和AES密钥进行解密获取手机号，然后进行登录，生成登录态</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">&quot;primary&quot;</span> open<span class="token operator">-</span>type<span class="token operator">=</span><span class="token string">&quot;getAuthorize&quot;</span> @getAuthorize<span class="token operator">=</span><span class="token string">&quot;getAliPhoneNumber&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;wx_login&quot;</span>
			scope<span class="token operator">=</span><span class="token string">'phoneNumber'</span><span class="token operator">&gt;</span>支付宝用户一键登录<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>

<span class="token comment">// 获取支付宝账号</span>
<span class="token function">getAliCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    uni<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      scopes<span class="token operator">:</span> <span class="token string">'auth_user'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">loginRes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>loginRes<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 支付宝授权登陆</span>
<span class="token keyword">async</span> <span class="token function">getAliPhoneNumber</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>uToast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'登陆中...'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> token <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAliToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
  my<span class="token punctuation">.</span><span class="token function">getPhoneNumber</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    scopes<span class="token operator">:</span> <span class="token string">'auth_user'</span><span class="token punctuation">,</span> <span class="token comment">// 支付宝主动授权</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> encryptedData <span class="token operator">=</span> res<span class="token punctuation">.</span>response<span class="token punctuation">;</span> <span class="token comment">// 手机加密串</span>
      <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
        token<span class="token punctuation">,</span>
        encryptedData
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      common<span class="token punctuation">.</span><span class="token function">aliMobileLogin</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> user_key<span class="token punctuation">,</span> user_id<span class="token punctuation">,</span> token<span class="token punctuation">,</span> open_id <span class="token punctuation">}</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">'授权失败'</span><span class="token punctuation">,</span>
        icon<span class="token operator">:</span> <span class="token string">'none'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div></li></ul> <h2 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h2> <ul><li><p>navigateTo</p> <p>保留当前页面，跳转到应用内的某个页面，使用uni.navigateBack可以返回到原页面。不能跳到tabbar页面，微信小程序中<font color="#e93011">页面栈最多十层</font>。</p></li> <li><p>redirectTo</p> <p>关闭当前页面，跳转到应用内的某个页面，但是不允许跳转到tabbar页面。</p></li> <li><p>reLaunch</p> <p>关闭所有页面，打开到应用内的某个页面</p></li> <li><p>switchTab</p> <p>跳转到tabBar页面，并关闭其他所有非tabBar页面。<br>
tabBar页面之间跳转并不会被关闭，所以给再次打开页面的用户体验一个很好的提升，依旧会<font color="#e93011">触发onShow生命周期</font>。</p></li></ul> <h2 id="页面实现"><a href="#页面实现" class="header-anchor">#</a> 页面实现</h2> <ul><li>自定义头部,tab栏(微信小程序)</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;nav&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;handleBack&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;cursor:pointer&quot;</span>
  <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">&quot;{height: navHeight + 'px', paddingTop: barPaddingHeight + 'px', background: back_color}&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;flex&quot;</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">&quot;{background: back_color}&quot;</span><span class="token operator">&gt;</span>
    内容自定义
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token comment">// 判断非刘海屏 </span>
<span class="token keyword">const</span> <span class="token function-variable function">noHairSreen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">top<span class="token punctuation">,</span> model</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> models <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;iPhone 6&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;iPhone 7&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;iPhone 8&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> top <span class="token operator">==</span> <span class="token number">24</span> <span class="token operator">||</span> top <span class="token operator">==</span> <span class="token number">28</span> <span class="token operator">||</span> models<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 判读刘海屏</span>
<span class="token keyword">const</span> <span class="token function-variable function">hairScreen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> model<span class="token punctuation">,</span> system<span class="token punctuation">,</span> platform <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
  <span class="token keyword">const</span> models <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">,</span> <span class="token string">'XR'</span><span class="token punctuation">,</span> <span class="token string">'XS Max'</span><span class="token punctuation">,</span> <span class="token string">'10'</span><span class="token punctuation">,</span> <span class="token string">'11'</span><span class="token punctuation">,</span> <span class="token string">'12'</span><span class="token punctuation">,</span> <span class="token string">'13'</span><span class="token punctuation">,</span> <span class="token string">'13 Pro'</span><span class="token punctuation">,</span> <span class="token string">'13 Max'</span><span class="token punctuation">]</span>
  	<span class="token keyword">const</span> isIphone <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> model<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>system<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'iOS'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> platform <span class="token operator">==</span> <span class="token string">'ios'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isIphone<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">/*
* barPaddingHeight -&gt; 胶囊距离顶部的距离，用于paddingTop
* navHeight -&gt; 顶部通栏的高度设置 默认设置是有刘海的高度
* botMenuHeight -&gt; 底部 tabBar 自定义高度
* offsetTop -&gt; 自定义筛选框吸顶的距离
*/</span>
uni<span class="token punctuation">.</span><span class="token function">getSystemInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> menuButton <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getMenuButtonBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 胶囊</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> top<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> menuButton<span class="token punctuation">;</span> <span class="token comment">// top 可用于区分机型</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'top:'</span> <span class="token operator">+</span> top<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> model <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'机型：'</span> <span class="token operator">+</span> model<span class="token punctuation">)</span>

    <span class="token comment">// barPaddingHeight -&gt; 胶囊距离顶部的距离，用于paddingTop</span>
    <span class="token comment">// navHeight -&gt; 顶部通栏的高度设置 默认设置是有刘海的高度</span>
    <span class="token comment">// botMenuHeight -&gt; 底部 tabBar 自定义高度</span>
    <span class="token keyword">let</span> barPaddingHeight<span class="token punctuation">,</span> navHeight <span class="token operator">=</span> height <span class="token operator">*</span> <span class="token number">2.5</span><span class="token punctuation">,</span> botMenuHeight<span class="token punctuation">;</span>
    
    barPaddingHeight <span class="token operator">=</span> top<span class="token punctuation">;</span>
    
    <span class="token comment">// 根据非刘海屏来设置顶部通栏的高度</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">noHairSreen</span><span class="token punctuation">(</span>top<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      navHeight <span class="token operator">=</span> height <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 处理刘海屏</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hairScreen</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      botMenuHeight <span class="token operator">=</span> <span class="token string">'160rpx'</span><span class="token punctuation">;</span>
      navHeight <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      botMenuHeight <span class="token operator">=</span> <span class="token string">'100rpx'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// offsetTop -&gt; 自定义筛选框吸顶的距离</span>
    <span class="token keyword">let</span> offsetTop <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> topNum <span class="token operator">=</span> navHeight <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>top <span class="token operator">==</span> <span class="token number">24</span> <span class="token operator">||</span> top <span class="token operator">==</span> <span class="token number">28</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        offsetTop <span class="token operator">=</span> topNum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>top <span class="token operator">==</span> <span class="token number">52</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        offsetTop <span class="token operator">=</span> topNum <span class="token operator">-</span> <span class="token number">16</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>top <span class="token operator">==</span> <span class="token number">54</span> <span class="token operator">||</span> top <span class="token operator">==</span> <span class="token number">26</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        offsetTop <span class="token operator">=</span> topNum <span class="token operator">-</span> <span class="token number">14</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        offsetTop <span class="token operator">=</span> topNum <span class="token operator">-</span> <span class="token number">8</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span> barPaddingHeight<span class="token punctuation">,</span> navHeight<span class="token punctuation">,</span> botMenuHeight<span class="token punctuation">,</span> offsetTop <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><ul><li>自定义组件</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
  		<span class="token string">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;page/index/index&quot;</span><span class="token punctuation">,</span>
  		<span class="token string">&quot;style&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  			<span class="token string">&quot;navigationBarTitleText&quot;</span><span class="token operator">:</span> <span class="token string">&quot;健康160&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// 微信自定义组件，组件内采用原生写法</span>
  			<span class="token string">&quot;mp-weixin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  				<span class="token string">&quot;navigationStyle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span>
  				<span class="token string">&quot;usingComponents&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  					<span class="token string">&quot;wxswiper&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/wxcomponents/wxSwiper/index&quot;</span>
  				<span class="token punctuation">}</span>
  			<span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 头条自定义组件</span>
  			<span class="token string">&quot;mp-toutiao&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  				<span class="token string">&quot;usingComponents&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  					<span class="token string">&quot;ttswiper&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/ttcomponents/ttSwiper/index&quot;</span>
  				<span class="token punctuation">}</span>
  			<span class="token punctuation">}</span>
  		<span class="token punctuation">}</span>
  	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token comment">// 插件目录结构及文件</span>
<span class="token string">&quot;wxSwiper&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  index<span class="token punctuation">.</span>vue<span class="token punctuation">,</span>  <span class="token comment">// 编译后自动生成</span>
  index<span class="token punctuation">.</span>js<span class="token punctuation">,</span>
  index<span class="token punctuation">.</span>json<span class="token punctuation">,</span>
  index<span class="token punctuation">.</span>wxml<span class="token punctuation">,</span>
  index<span class="token punctuation">.</span>wxss
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ul><li>自定义插件</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// manifest.json  小程序相关</span>
<span class="token string">&quot;mp-weixin&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;appid&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;xxxxxx&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;plugins&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;routePlan&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;version&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1.0.12&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;provider&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;wx50b5593e81dd937a&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
*	调用腾讯小程序地图
* lat: 经度
* lon: 纬度
* address: 目的地址
*/</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">openWxLocation</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">lat<span class="token punctuation">,</span> lon<span class="token punctuation">,</span> address</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 直接调用相应的插件</span>
  <span class="token keyword">let</span> plugin <span class="token operator">=</span> <span class="token function">requirePlugin</span><span class="token punctuation">(</span><span class="token string">'routePlan'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  key <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>common<span class="token punctuation">.</span>tencent_map_key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token comment">//使用在腾讯位置服务申请的key</span>
  referer <span class="token operator">=</span> <span class="token string">'预约体检看医生'</span><span class="token punctuation">,</span> <span class="token comment">//调用插件的app的名称</span>
  endPoint <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">//终点</span>
    <span class="token string">'name'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token string">'latitude'</span><span class="token operator">:</span> lon<span class="token punctuation">,</span>
    <span class="token string">'longitude'</span><span class="token operator">:</span> lat
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 访问相应的插件url</span>
  uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token string">'plugin://routePlan/index?key='</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">'&amp;referer='</span> <span class="token operator">+</span> referer <span class="token operator">+</span> <span class="token string">'&amp;endPoint='</span> <span class="token operator">+</span> endPoint
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ul><li>scroll-view
可用于去除滚动条，横向tab栏切换，指定位置跳转，置顶功能</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>body<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scroll-view</span> 
  <span class="token attr-name">:scroll-y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isScroll<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">:scroll-top</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currScrollPos<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@scroll</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleOnScroll<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scrollView<span class="token punctuation">&quot;</span></span> 
  <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
      自定义内容
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scroll-view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">.body</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.scrollView</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>
  <span class="token selector">::-webkit-scrollbar</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ul><li>注意</li></ul> <p>scroll-view高度不要设置为相对高度，如100%。否则，page页面的滚动条又会出现了！！！
可以这样做：</p> <scroll-view scroll-y="" style="width:100%;height:100vh;"></scroll-view> <p>如果仍然无效，减少height的值，例如设为height:99vh。scroll-view高度大于page高度仍会出现滚动条的。</p> <p>父元素如page记得设置：</p> <p>overflow: hidden;</p> <h2 id="vue"><a href="#vue" class="header-anchor">#</a> Vue</h2> <ul><li>富文本</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 可以兼容多数html解析情况，滚动兼容可借助scroll-view</span>
<span class="token operator">&lt;</span>u<span class="token operator">-</span>parse <span class="token operator">:</span>html<span class="token operator">=</span><span class="token string">&quot;content&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>u<span class="token operator">-</span>parse<span class="token operator">&gt;</span>
<span class="token comment">// 支付宝小程序 引入了html-parser js</span>
<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HTMLParser</span><span class="token punctuation">(</span>htmlText<span class="token punctuation">)</span>
<span class="token comment">// 微信小程序</span>
<span class="token comment">// 小程序富文本不支持 textarea, 格式化work_time</span>
<span class="token function">parseWorkTime</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'&lt;textarea'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> reg1 <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;textarea</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span>
    <span class="token keyword">const</span> reg2 <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;\/textarea&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>workTime <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg1<span class="token punctuation">,</span> <span class="token string">'&lt;div'</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>workTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>workTime<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg2<span class="token punctuation">,</span> <span class="token string">'&lt;/div&gt;'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>workTime <span class="token operator">=</span> time
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li><p>接口请求写在哪里合适（即返回页面不刷新问题）</p> <ol><li>可以写在onShow，onLoad，created，mounted</li></ol> <p>但是：写在onShow里面最好 <br></p> <p>原因：在很多情况下跳转后都需要刷新页面数据。因为onshow是在页面展示时候触发，通过uni.navigateTo不会销毁页面，返回时候页面的onLoad不会触发。例如通过导航栏返回按钮图标或者uni.navigateTo跳转到指定页面需要刷新页面数据时候，onShow只要页面展示了就会请求</p> <ol start="2"><li>对于请求参数怎么解决</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 获取url参数</span>
<span class="token keyword">const</span> <span class="token function-variable function">getPathParams</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token function">getCurrentPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> currentPage <span class="token operator">=</span> page<span class="token punctuation">[</span>page<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token keyword">return</span> currentPage<span class="token punctuation">.</span>options<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 获取当前页面路径及参数</span>
<span class="token keyword">const</span> <span class="token function-variable function">getCurrentPath</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token function">getCurrentPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    currentPage <span class="token operator">=</span> page<span class="token punctuation">[</span>page<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    current_url <span class="token operator">=</span> currentPage<span class="token punctuation">.</span>route<span class="token punctuation">,</span>

    <span class="token comment">// 当前路径参数</span>
    options <span class="token operator">=</span> currentPage<span class="token punctuation">.</span>options<span class="token punctuation">,</span>
    <span class="token comment">// 新拼接url</span>
    url_params <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      url_params <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url_params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>current_url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url_params<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>current_url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li> <li><p>微信小程序margin-bottom失效（有且只有ios系统上是失效的）</p> <p>针对底部tab或者position：fixed 区域，margin-bottom失效后，可以在底部增加一个空白的view设置高度即可</p></li></ul> <h2 id="数据跟踪"><a href="#数据跟踪" class="header-anchor">#</a> 数据跟踪</h2> <h3 id="神策-event"><a href="#神策-event" class="header-anchor">#</a> 神策 Event</h3> <ul><li><p>Who</p> <p>即参与这个事件的用户是谁</p></li> <li><p>When</p> <p>即这个事件发生的实际时间</p></li> <li><p>Where</p> <p>即事件发生的地点</p></li> <li><p>How</p> <p>即用户从事这个事件的方式</p></li> <li><p>What</p> <p>描述用户所做的这个事件的具体内容</p></li></ul> <h3 id="神策支持的-uni-app-sdk"><a href="#神策支持的-uni-app-sdk" class="header-anchor">#</a> 神策支持的 uni-app SDK</h3> <p><a href="https://manual.sensorsdata.cn/sa/latest/uni-app-sdk-41845382.html" target="_blank" rel="noopener noreferrer">神策地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><p>集成 uni-app 插件</p> <p>本插件使用 H5、App、微信小程序、阿里小程序、百度小程序和头条小程序进行数据采集 <br></p> <p>下载神策 uni-app 插件，将下载的 Sensorsdata-UniPlugin-JS 文件夹放在自己项目中的  common 文件夹中。</p></li> <li><p>初始化</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> sensors <span class="token keyword">from</span> <span class="token string">'@/common/Sensorsdata-UniPlugin-JS/index.js'</span>  <span class="token comment">// 引入模块</span>
<span class="token keyword">const</span> <span class="token function-variable function">sensorsDate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token comment">// 配置初始化参数</span>
   sensors<span class="token punctuation">.</span><span class="token function">setPara</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   	name<span class="token operator">:</span> <span class="token string">'mp-weixin'</span><span class="token punctuation">,</span>  <span class="token comment">// 上报平台</span>
   	server_url<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span> <span class="token operator">?</span> <span class="token string">'devUrl'</span> <span class="token operator">:</span>	<span class="token string">'proUrl'</span><span class="token punctuation">,</span> <span class="token comment">// 数据上报地址</span>
   	<span class="token comment">// 全埋点控制开关</span>
   	autoTrack<span class="token operator">:</span> <span class="token punctuation">{</span>
   		appLaunch<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 默认为 true，false 则关闭 $MPLaunch 事件采集</span>
   		appShow<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 默认为 true，false 则关闭 $MPShow 事件采集</span>
   		appHide<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 默认为 true，false 则关闭 $MPHide 事件采集</span>
   		pageShow<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 默认为 true，false 则关闭 $MPViewScreen 事件采集</span>
   		pageShare<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 默认为 true，false 则关闭 $MPShare 事件采集</span>
   		mpClick<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 默认为 false，true 则开启 $MPClick 事件采集</span>
   		mpFavorite<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 默认为 true，false 则关闭 $MPAddFavorites 事件采集</span>
   		pageLeave<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 默认为 false， true 则开启 $MPPageLeave事件采集</span>
   	<span class="token punctuation">}</span><span class="token punctuation">,</span>
   	<span class="token comment">// 是否允许控制台打印查看埋点数据(建议开启查看)</span>
   	show_log<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
   	app_flush_interval<span class="token operator">:</span> <span class="token number">15000</span><span class="token punctuation">,</span>         <span class="token comment">//设置两次数据发送的最小时间间隔 @Platform Android&amp;iOS</span>
   	app_flush_bulkSize<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>            <span class="token comment">//设置本地缓存日志的最大条目数，最小 50 条 @Platform Android&amp;iOS</span>
   	app_flush_network_policy<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>      <span class="token comment">//设置 flush 时网络发送策略，默认 3G、4G、WI-FI 环境下都会尝试 flush  @Platform Android&amp;iOS</span>
   	app_session_interval_time<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>  <span class="token comment">//Session 时长，若 App 在后台超过设定事件，则认为当前 Session 结束，发送 $AppEnd 事件，单位毫秒 @Platform Andorid</span>
   	app_data_collect<span class="token operator">:</span> <span class="token boolean">true</span>             <span class="token comment">//是否开启数据采集 @Platform Android</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
   	channel_id<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 渠道ID</span>
   	channel_name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 渠道名称</span>
   	pos_source<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
   	promote_channel<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 推广渠道</span>
   	pos_type<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
   	user_agent<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// 注册公共属性</span>
   sensors<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 初始化 SDK</span>
   sensors<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="自定义事件"><a href="#自定义事件" class="header-anchor">#</a> 自定义事件</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// type -&gt; 自定义事件</span>
<span class="token keyword">const</span> <span class="token function-variable function">customPoint</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> expend_params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token comment">// 基础参数</span>
   <span class="token keyword">let</span> base_params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>base_params<span class="token punctuation">,</span> expend_params<span class="token punctuation">)</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	<span class="token keyword">if</span> <span class="token punctuation">(</span>base_params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   		<span class="token keyword">delete</span> base_params<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
   	<span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// 利用上面注册的 sensors</span>
   sensors<span class="token punctuation">.</span><span class="token function">track</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> base_params<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="服务端上报"><a href="#服务端上报" class="header-anchor">#</a> 服务端上报</h3> <p>主要是前端配置好数据传输给服务端，格式 json 形式 <br></p> <p>需要获取 sensors 的预置信息</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token keyword">const</span> presetProperty <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sensors<span class="token punctuation">.</span><span class="token function">getPresetProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 需要传给服务端的信息</span>
 <span class="token keyword">const</span> defineProps <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>自定义 <span class="token punctuation">}</span>
 <span class="token keyword">const</span> _scdata <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>presetProperty<span class="token punctuation">,</span> defineProps<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="广告点击"><a href="#广告点击" class="header-anchor">#</a> 广告点击</h3> <ul><li><p>植入广告的自动上报</p></li> <li><p>跟踪路径最后点击广告的上报，上报整体路径及当前广告，且去除重复路径</p></li></ul> <p>上报方式已经介绍过了，就不过多讲述</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 路径去重</span>
<span class="token keyword">const</span> <span class="token function-variable function">removePath</span> <span class="token operator">=</span> <span class="token parameter">arr</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> savelast <span class="token operator">=</span> arr
   <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// 存储首次出现的位置  key: 'a'  value: 0</span>
   <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
   <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
   <span class="token keyword">let</span> last <span class="token operator">=</span> <span class="token number">0</span>
   <span class="token comment">// 这种例外情况 ['a','b','c','a','b', 'a', 'b']   -&gt; ['a','b','c','a','b']</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>lastArr<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> lastArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">===</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	<span class="token keyword">return</span> ret <span class="token operator">=</span> lastAndPath
   <span class="token punctuation">}</span>
   arr <span class="token operator">=</span> lastAndPath<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token operator">...</span>arr<span class="token punctuation">)</span>
   <span class="token comment">// 超过10条保存最新10条</span>
   arr <span class="token operator">=</span> <span class="token function">lessTen</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
   <span class="token comment">// 普通   ['a','b','c','a','b', 'c', 'd'] -&gt; ['a','b','c', 'd']</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	<span class="token keyword">let</span> ch <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
   	<span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   		last <span class="token operator">=</span> i
   		<span class="token comment">// 再次出现了   ['a','b','c','a']</span>
   		<span class="token keyword">let</span> offset <span class="token operator">=</span> i <span class="token operator">-</span> obj<span class="token punctuation">[</span>ch<span class="token punctuation">]</span>   <span class="token comment">// 3 </span>
   		<span class="token keyword">let</span> prev <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>ch<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token comment">// ['a','b','c']</span>
   		<span class="token keyword">let</span> next <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> offset<span class="token punctuation">)</span> <span class="token comment">// ['a','b','c']</span>
   		<span class="token keyword">if</span> <span class="token punctuation">(</span>prev<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">!==</span> next<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   			ret <span class="token operator">=</span> ret<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token operator">...</span>next<span class="token punctuation">)</span> 
   		<span class="token punctuation">}</span> 
   		i <span class="token operator">=</span> i <span class="token operator">+</span> next<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>  <span class="token comment">// 5</span>
   	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
   		ret<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> 
   	<span class="token punctuation">}</span>
   	obj<span class="token punctuation">[</span>ch<span class="token punctuation">]</span> <span class="token operator">=</span> i
   	i<span class="token operator">++</span>
   <span class="token punctuation">}</span>
   lastArr <span class="token operator">=</span> savelast
   uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'pathArr'</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span>
   lastAndPath <span class="token operator">=</span> ret
   <span class="token keyword">return</span> ret
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="分析模块"><a href="#分析模块" class="header-anchor">#</a> 分析模块</h3> <ul><li><p>事件分析</p></li> <li><p>留存分析</p></li> <li><p>LTV分析</p></li> <li><p>归因分析</p></li> <li><p>用户路径分析</p></li></ul> <p>通过这些分析可以给我们的产品带来更多的效益，针对特定的问题出发，解决潜在的问题，更好的提高增量</p> <h3 id="友盟"><a href="#友盟" class="header-anchor">#</a> 友盟</h3> <ul><li>微信小程序</li></ul> <p>适用产品：U-MiniProgram <br></p> <p>功能介绍：适用于微信小程序统计，新增推广监测、矩阵分析等功能，支持多种ID统计体系，如：openid、unionid、用户账号id等，可进行跨小程序、跨平台的ID归一。支持原生框架及第三方框架：uniapp、taro、chameleon、mpvue、wepy1.x、wepy2。</p> <ul><li><p>实时分析</p></li> <li><p>事件分析</p></li> <li><p>矩阵分析</p></li> <li><p>自制看板</p></li></ul> <p>目前是针对大数据采集进行的全埋点使用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> uma <span class="token keyword">from</span> <span class="token string">'umtrack-wx'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">umeng</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   uma<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       appKey<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 申请友盟的 appkey</span>
       useOpenid<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
       autoGetOpenid<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
       debug<span class="token operator">:</span> <span class="token boolean">false</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> uma
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="消息订阅"><a href="#消息订阅" class="header-anchor">#</a> 消息订阅</h2> <ul><li><p>消息类型</p> <ol><li><p>一次性订阅消息</p></li> <li><p>长期订阅消息</p></li> <li><p>设备订阅消息</p></li></ol></li> <li><p>微信小程序</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ids = [hash1,hash2] 模版ids</span>
uni<span class="token punctuation">.</span><span class="token function">requestSubscribeMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  tmplIds<span class="token operator">:</span> ids<span class="token punctuation">,</span>
  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(res);</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(err)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// resolve()</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>注意：<br></p> <ol><li>一次性模板 id 和永久模板 id 不可同时使用。</li></ol> <ul><li>支付宝小程序</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/* 
  1 支付宝小程序后台引入该订阅插件
  2 manifest.json 声明要使用的插件
  3 pages文件中要使用该插件的页面上接入具体使用的组件
  4 页面中直接引入 &lt;subscribe-msg /&gt;
  5 js 中直接 requirePlugin('subscribeMsg')
*/</span>
<span class="token comment">// manifest.json</span>
<span class="token string">&quot;mp-alipay&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;usingComponents&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;component2&quot;</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;appid&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2018062060413648&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;plugins&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;subscribeMsg&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;version&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;provider&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2021001155639035&quot;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// pages.json</span>
<span class="token string">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token string">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;confirm/confirm&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;style&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;navigationBarTitleText&quot;</span><span class="token operator">:</span> <span class="token string">&quot;预约挂号&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;navigationBarBackgroundColor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#fff&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;usingComponents&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;subscribe-msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;plugin://subscribeMsg/subscribe-msg&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token comment">// 页面中引入组件 </span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  	<span class="token operator">&lt;</span>subscribe<span class="token operator">-</span>msg <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token comment">// js中使用</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> requestSubscribeMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">requirePlugin</span><span class="token punctuation">(</span><span class="token string">'subscribeMsg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 触发消息订阅弹框</span>
<span class="token function">requestSubscribeMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
  entityIds<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'xxxxxx'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'订阅消息返回-'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>注意：<br></p> <ol><li>开发者应在用户操作控件后拉起小程序插件，不应在加载页面过程中拉起小程序插件，保证良好的用户体验</li> <li>一次性模板 ID 和长期性模板 ID 不可同时使用</li> <li>开发者调用插件，一次性最多传入三个模板 ID</li></ol> <h2 id="webview"><a href="#webview" class="header-anchor">#</a> webview</h2> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-view</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleViewMess<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>注意：<br></p> <ol><li>开发者工具上，可以在 web-view 组件上通过右键 - 调试，打开 web-view 组件的调试</li> <li>每个页面只能有一个 web-view，web-view 会自动铺满整个页面，并覆盖其他组件</li> <li>web-view 网页与小程序之间不支持除 JSSDK 提供的接口之外的通信</li> <li>在 iOS 中，若存在 JSSDK 接口调用无响应的情况，可在 web-view 的 src 后面加个#wechat_redirect解决</li> <li><font color="#e93011">避免在链接中带有中文字符，在 iOS 中会有打开白屏的问题，建议加一下 encodeURIComponent </font></li></ol> <h2 id="分享"><a href="#分享" class="header-anchor">#</a> 分享</h2> <ul><li><p>原生分享</p> <ol><li>全局注册分享组件</li> <li>设置默认分享内容</li> <li>每个需要分享的页面，修改指定内容</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
  1 全局注册分享组件
  2 设置默认分享内容
  3 每个需要分享的页面，修改指定内容
*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">//设置默认的分享参数</span>
      share<span class="token operator">:</span> <span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">'健康看病就医 就选健康160'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> <span class="token string">'/page/index/index'</span><span class="token punctuation">,</span>
        imageUrl<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        desc<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        content<span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 分享会触发该事件</span>
  <span class="token function">onShareAppMessage</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> title<span class="token punctuation">,</span> path<span class="token punctuation">,</span> imageUrl<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> content <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>share<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      title <span class="token operator">=</span> title<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...'</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> title<span class="token punctuation">,</span>
      path<span class="token operator">:</span> path<span class="token punctuation">,</span>
      imageUrl<span class="token operator">:</span> imageUrl<span class="token punctuation">,</span>
      desc<span class="token operator">:</span> desc<span class="token punctuation">,</span>
      content<span class="token operator">:</span> content<span class="token punctuation">,</span>
      <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token string">'分享成功'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token string">'分享失败'</span><span class="token punctuation">,</span>
          icon<span class="token operator">:</span> <span class="token string">'none'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取当前url路径</span>
      <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getCurrentPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 修改分享path 首页中转 有返回home的能力</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>share<span class="token punctuation">.</span>path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/page/index/index?redirectURL=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div></li> <li><p>H5 分享</p> <p>思想和原生分享大致一样，只不过跳转的是webview :</p> <ol><li>利用postMessage 通信能力 web传递当前页面url信息</li> <li>webview接收后，修改当前分享的path</li> <li>中转首页，判断后跳转webview的指定url</li></ol></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
  1 利用postMessage 通信能力 web传递当前页面url信息
  2 webview接收后，修改当前分享的path
  3 中转首页，判断后跳转webview的指定url
*/</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>web<span class="token operator">-</span>view <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;url&quot;</span> @message<span class="token operator">=</span><span class="token string">&quot;handleViewMess&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>web<span class="token operator">-</span>view<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 接收 web 通信的信息</span>
      <span class="token function">handleViewMess</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'分享信息：------------'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>detail <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 取最新的一条数据</span>
          <span class="token keyword">const</span> item <span class="token operator">=</span> event<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>data<span class="token punctuation">[</span>event<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span>
            title<span class="token punctuation">,</span>
            imgUrl<span class="token punctuation">,</span>
            link<span class="token punctuation">,</span>
            desc
          <span class="token punctuation">}</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>share <span class="token operator">=</span> <span class="token punctuation">{</span>
            title<span class="token operator">:</span> desc <span class="token operator">?</span> desc <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            desc<span class="token operator">:</span> desc <span class="token operator">?</span> desc <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            imageUrl<span class="token operator">:</span> imgUrl<span class="token punctuation">,</span>
            path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/page/index/index?jumpWebview=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="支付"><a href="#支付" class="header-anchor">#</a> 支付</h2> <ul><li>微信</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
  provider: 服务提供商
  timeStamp: 时间戳
  nonceStr: 随机字符串
  signType: 签名算法
  paySign: 签名
  package: 统一下单接口返回的prepay_id参数值
*/</span>
<span class="token function">weixinPay</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  uni<span class="token punctuation">.</span><span class="token function">requestPayment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    provider<span class="token operator">:</span> <span class="token string">'wxpay'</span><span class="token punctuation">,</span>
    timeStamp<span class="token operator">:</span> item<span class="token punctuation">.</span>timeStamp<span class="token punctuation">,</span>
    nonceStr<span class="token operator">:</span> item<span class="token punctuation">.</span>nonceStr<span class="token punctuation">,</span>
    signType<span class="token operator">:</span> <span class="token string">'MD5'</span><span class="token punctuation">,</span>
    paySign<span class="token operator">:</span> item<span class="token punctuation">.</span>paySign<span class="token punctuation">,</span>
    <span class="token keyword">package</span><span class="token operator">:</span> item<span class="token punctuation">.</span>package<span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">pay_res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// console.log('success:' + pay_res);</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>uToast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">'支付成功'</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'success'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// console.log('fail:' + JSON.stringify(err));</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>uToast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'warning'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ul><li>支付宝</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
  provider: 服务提供商
  orderInfo: 支付宝小程序的 orderInfo(支付宝的规范为 tradeNO) 为 String 类型，表示支付宝交易号
*/</span>
<span class="token function">aliPay</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  uni<span class="token punctuation">.</span><span class="token function">requestPayment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    provider<span class="token operator">:</span> <span class="token string">'alipay'</span><span class="token punctuation">,</span>
    orderInfo<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">pay_res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// console.log('success:' + JSON.stringify(res));</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>uToast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">'支付成功'</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'success'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// console.log('fail:' + JSON.stringify(err));</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>uToast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'warning'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2023-02-12</span></div></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-898d6c54><li class="level-2" data-v-898d6c54><a href="/blog/category/applets/01.html#概览" class="sidebar-link reco-side-概览" data-v-898d6c54>概览</a></li><li class="level-2" data-v-898d6c54><a href="/blog/category/applets/01.html#登录" class="sidebar-link reco-side-登录" data-v-898d6c54>登录</a></li><li class="level-3" data-v-898d6c54><a href="/blog/category/applets/01.html#微信" class="sidebar-link reco-side-微信" data-v-898d6c54>微信</a></li><li class="level-3" data-v-898d6c54><a href="/blog/category/applets/01.html#支付宝" class="sidebar-link reco-side-支付宝" data-v-898d6c54>支付宝</a></li><li class="level-2" data-v-898d6c54><a href="/blog/category/applets/01.html#路由" class="sidebar-link reco-side-路由" data-v-898d6c54>路由</a></li><li class="level-2" data-v-898d6c54><a href="/blog/category/applets/01.html#页面实现" class="sidebar-link reco-side-页面实现" data-v-898d6c54>页面实现</a></li><li class="level-2" data-v-898d6c54><a href="/blog/category/applets/01.html#vue" class="sidebar-link reco-side-vue" data-v-898d6c54>Vue</a></li><li class="level-2" data-v-898d6c54><a href="/blog/category/applets/01.html#数据跟踪" class="sidebar-link reco-side-数据跟踪" data-v-898d6c54>数据跟踪</a></li><li class="level-3" data-v-898d6c54><a href="/blog/category/applets/01.html#神策-event" class="sidebar-link reco-side-神策-event" data-v-898d6c54>神策 Event</a></li><li class="level-3" data-v-898d6c54><a href="/blog/category/applets/01.html#神策支持的-uni-app-sdk" class="sidebar-link reco-side-神策支持的-uni-app-sdk" data-v-898d6c54>神策支持的 uni-app SDK</a></li><li class="level-3" data-v-898d6c54><a href="/blog/category/applets/01.html#自定义事件" class="sidebar-link reco-side-自定义事件" data-v-898d6c54>自定义事件</a></li><li class="level-3" data-v-898d6c54><a href="/blog/category/applets/01.html#服务端上报" class="sidebar-link reco-side-服务端上报" data-v-898d6c54>服务端上报</a></li><li class="level-3" data-v-898d6c54><a href="/blog/category/applets/01.html#广告点击" class="sidebar-link reco-side-广告点击" data-v-898d6c54>广告点击</a></li><li class="level-3" data-v-898d6c54><a href="/blog/category/applets/01.html#分析模块" class="sidebar-link reco-side-分析模块" data-v-898d6c54>分析模块</a></li><li class="level-3" data-v-898d6c54><a href="/blog/category/applets/01.html#友盟" class="sidebar-link reco-side-友盟" data-v-898d6c54>友盟</a></li><li class="level-2" data-v-898d6c54><a href="/blog/category/applets/01.html#消息订阅" class="sidebar-link reco-side-消息订阅" data-v-898d6c54>消息订阅</a></li><li class="level-2" data-v-898d6c54><a href="/blog/category/applets/01.html#webview" class="sidebar-link reco-side-webview" data-v-898d6c54>webview</a></li><li class="level-2" data-v-898d6c54><a href="/blog/category/applets/01.html#分享" class="sidebar-link reco-side-分享" data-v-898d6c54>分享</a></li><li class="level-2" data-v-898d6c54><a href="/blog/category/applets/01.html#支付" class="sidebar-link reco-side-支付" data-v-898d6c54>支付</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div></div><!----></div></div>
    <script src="/blog/assets/js/app.e39775f7.js" defer></script><script src="/blog/assets/js/4.fb892f91.js" defer></script><script src="/blog/assets/js/1.43efb79e.js" defer></script><script src="/blog/assets/js/14.9bc216f3.js" defer></script><script src="/blog/assets/js/13.b05cf968.js" defer></script>
  </body>
</html>
